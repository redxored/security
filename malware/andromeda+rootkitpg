

Andromeda String Analysis
 
tapi.dll RPC
written in VB6
ascii,17,-,-,kluqjfa_cgnule`dl
ascii,7,-,-,wsnmp
wsnmp32
 
uses snmp for some reason probably used to get cisco mibs could be a pos trojan with andromeda as a botnet
virus total is confused
mscomctl.ocx
 
ogname njuuby.exe
 
creates and reads files
writes and reads files
 
drops this file
unicode,22,-,x,*\AC:\FA2\13_P\FYU.vbp
 
ntmsapi
GetNtmsRequestOrder
could be used to infext usb drives
cpuld be a backdoor
 
 
ODBC32
accesses sql db
 
 
ollydbg
ntdll.memcpy 77127A6D   BE 06C90F77      MOV ESI,ntdll.770FC906                   ; UNICODE ".Local"
rtldebugprinttimes antidebugging
7712878C   E8 5F52FCFF      CALL ntdll.ZwSetInformationWorkerFactory
direct syscalls
77138594   68 E0B00F77      PUSH ntdll.770FB0E0                      ; ASCII "minkernel\ntdll\ldrinit.c"
 
771384E6   68 0EB70F77      PUSH ntdll.770FB70E                      ; ASCII "LdrpInitializeProcess"
 
so I guess it loads ldrinit.c
ldrp is the loader for ntdll
it's not a legitimate file
 
ldrpresolvedllname(minkernel\ntdll\ldrfind.c)
77139063   68 16BF0F77      PUSH ntdll.770FBF16                      ; UNICODE "UseImpersonatedDeviceMap"
 
7714D145   E8 76280500      CALL ntdll.EtwProcessPrivateLoggerReques>
7714D504   68 E8C50F77      PUSH ntdll.770FC5E8                      ; ASCII "minkernel\ntdll\ldrtls.c"
 
7714D4FA   68 78C60F77      PUSH ntdll.770FC678                      ; ASCII "LdrpCallTlsInitializers"
 
 
7714D9E8   68 ECC10F77      PUSH ntdll.770FC1EC                      ; ASCII "minkernel\ntdll\ldrsnap.c"
 
7714E0F1   68 2AB40F77      PUSH ntdll.770FB42A                      ; ASCII "Loading the shim engine DLL "%wZ" failed with status 0x%08lx
"
7714E0F6   57               PUSH EDI
7714E0F7   68 68B40F77      PUSH ntdll.770FB468                      ; ASCII "LdrpInitShimEngine"
7714E0FC   68 E6080000      PUSH 8E6
7714E101   68 E0B00F77      PUSH ntdll.770FB0E0                      ; ASCII "minkernel\ntdll\ldrinit.c"
7714E106   E8 4C360100      CALL ntdll.77161757
7714E10B   A1 00211B77      MOV EAX,DWORD PTR DS:[771B2100]
7714E110   83C4 1C          ADD ESP,1C
 
.txt1
..txt2
7714F8BC   68 66E90F77      PUSH ntdll.770FE966                      ; UNICODE "ASqmManifest_%x"
 
771599B4   68 B2ED0F77      PUSH ntdll.770FEDB2                      ; ASCII "!(askd.Flags & ACTIVATION_CONTEXT_SECTION_KEYED_DATA_FLAG_FOUND_IN_SYSTEM_DEFAULT)"
 
 
7715998D   68 52ED0F77      PUSH ntdll.770FED52                      ; ASCII "sxsisol_SearchActCtxForDllName"
 
77159B0E   68 5EEC0F77      PUSH ntdll.770FEC5E                      ; ASCII "minkernel\ntdll\sxsisol.cpp"
 
need a kerneldebugger man
 
moves now to the vb code
 
00401D20   . 5900 5500 2E00>UNICODE "YU.vbp",0
 
keeps using getproccallengine
tapi32
linegetagentstatus
msvbcfunccall(tapi32.linegetagentstatus
 
uses kernelbase.dll
I think it's andromeda with a rootkit plugin
 
try memory forensics later
overall complex piece of malware great infection vector if only they did a better job at obfuscation
 
w
 
ModLoad: 00000000`75c40000 00000000`75d80000   C:\Windows\SysWOW64\KERNEL32.DLL
ModLoad: 00000000`75d80000 00000000`75e57000   C:\Windows\SysWOW64\KERNELBASE.dll
ModLoad: 00000000`6e510000 00000000`6e5b0000   C:\Windows\SysWOW64\apphelp.dll
SHIMVIEW: ShimInfo(Complete)
ModLoad: 00000000`748f0000 00000000`75bac000   C:\Windows\SysWOW64\Shell32.dll
ModLoad: 00000000`6e430000 00000000`6e50e000   C:\Windows\SysWOW64\OPENGL32.DLL
ModLoad: 00000000`76090000 00000000`761e3000   C:\Windows\SysWOW64\user32.DLL
ModLoad: 00000000`75bb0000 00000000`75c2c000   C:\Windows\SysWOW64\ADVAPI32.DLL
ModLoad: 00000000`66000000 00000000`66153000   C:\Windows\SysWOW64\MSVBVM60.DLL
ModLoad: 00000000`76b40000 00000000`76c03000   C:\Windows\SysWOW64\msvcrt.dll
ModLoad: 00000000`75e60000 00000000`75fdd000   C:\Windows\SysWOW64\combase.dll
ModLoad: 00000000`74700000 00000000`74745000   C:\Windows\SysWOW64\SHLWAPI.dll
ModLoad: 00000000`76a30000 00000000`76b3f000   C:\Windows\SysWOW64\GDI32.dll
ModLoad: 00000000`6e400000 00000000`6e425000   C:\Windows\SysWOW64\GLU32.dll
ModLoad: 00000000`6e310000 00000000`6e3fc000   C:\Windows\SysWOW64\DDRAW.dll
ModLoad: 00000000`76040000 00000000`76081000   C:\Windows\SysWOW64\sechost.dll
ModLoad: 00000000`765e0000 00000000`7669a000   C:\Windows\SysWOW64\RPCRT4.dll
ModLoad: 00000000`76900000 00000000`76a29000   C:\Windows\SysWOW64\ole32.dll
ModLoad: 00000000`766a0000 00000000`76735000   C:\Windows\SysWOW64\OLEAUT32.dll
ModLoad: 00000000`6e300000 00000000`6e307000   C:\Windows\SysWOW64\DCIMAN32.dll
ModLoad: 00000000`746d0000 00000000`746ee000   C:\Windows\SysWOW64\SspiCli.dll
ModLoad: 00000000`746c0000 00000000`746ca000   C:\Windows\SysWOW64\CRYPTBASE.dll
ModLoad: 00000000`74660000 00000000`746b4000   C:\Windows\SysWOW64\bcryptPrimitives.dll
ModLoad: 765b0000 765d7000   C:\Windows\SysWOW64\IMM32.DLL
ModLoad: 76470000 76582000   C:\Windows\SysWOW64\MSCTF.dll
ModLoad: 70a10000 70a19000   C:\Windows\SysWOW64\kernel.appcore.dll
ModLoad: 71700000 717ed000   C:\Windows\SysWOW64\uxtheme.dll
ModLoad: 6e280000 6e2fe000   C:\Windows\SysWOW64\SXS.DLL
ModLoad: 76350000 763dd000   C:\Windows\SysWOW64\clbcatq.dll
ModLoad: 6e250000 6e27c000   C:\Windows\SysWOW64\scrrun.dll
ModLoad: 74630000 74638000   C:\Windows\SysWOW64\VERSION.dll
 
all windbg will show
it deleted itself immediately after I ran it manually
procmon
